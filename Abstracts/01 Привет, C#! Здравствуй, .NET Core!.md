## About
Abstract: C# 9 and .NET 5 - Modern Cross-Platform Development - Mark J. Price

Languages: rus, ukr, eng

Chapters: 1. Привет, C#! Здравствуй, .NET Core!

# 1. Привет, C#! Здравствуй, .NET Core!

## В этой главе:

* настройка среды разработки;
* знакомство с .NET;
* разработка консольных приложений с использованием Visual Studio Code;
* управление исходным кодом с помощью GitHub;
* поиск справочной информации.

## Настройка среды разработки

Для работы бутет использоваться **Visual Studio Code**

### Некоторые полезные сочетания клавиш (Windows)

* Отобразить панель команд: `Ctrl + Shift + P`,
`F1`
* Переход к определению: `F12`
* Назад: `Alt + ←`
* Далее: `Alt + →`
* Отобразить терминал: `Ctrl + '`
* Новый терминал: `Ctrl + Shift + '`
* Переключить на строчный комментарий: `Ctrl + /`
* Переключить на блочный комментарий: `Shift + Alt + A`

### Скачивание и установка среды **Visual Studio Code**

1. Скачайте и установите либо стабильную версию Stable, либо версию Insiders среды [Visual Studio Code](https://code.visualstudio.com/).
2. Скачайте и установите среду [.NET 5 SDK](https://dotnet.microsoft.com/en-us/download/dotnet/thank-you/sdk-7.0.102-windows-x64-installer).
3. Для установки расширения **C#** вам необходимо сначала запустить приложение **Visual Studio Code**.
4. В **Visual Studio Code** нажмите значок **Extensions** (Расширения) или выберите **View** > **Extensions** (Вид > Расширения).
5. **C#** — одно из самых популярных доступных расширений, поэтому вы должны увидеть его в верхней части списка или можете ввести *C#* в поле поиска.
6. Нажмите кнопку **Install** (Установить) и дождитесь скачивания и установки пакета.

### Необходимые расширения (включая установленное в пунктах 5.-6.)

#### 1. **C# for Visual Studio Code** (powered by OmniSharp)

* Поддержка редактирования C#, включая подсветку синтаксиса;
* IntelliSense;
* переход к определению;
* поиск ссылок;
* поддержка отладки для .NET и проектов csproj для операционных систем Windows, macOS и Linux

#### 2. **MSBuild project tools**

* Предоставляет файлы проектов IntelliSense для MSBuild, включая автозаполнение
для элементов <PackageReference>

#### 3. **Документация XML в языке C#**

* Создание комментариев документации XML

#### 4. **REST-клиент**

* Отправка HTTP-запроса и просмотр ответа непосредственно в Visual Studio Code

#### 5. **Декомпилятор ILSpy .NET**

* Декомпиляция сборки MSIL — поддержка среды .NET Framework, .NET Core и .NET Standard

## Знакомство с **.NET**

NET 5, .NET Framework, .NET Core и Xamarin — cвязанные и зависимые друг от друга платформы для разработки приложений и сервисов.

### Обзор **.NET Framework**

NET Framework — платформа для разработки, включающая общеязыковую исполняющую среду (Common Language Runtime, CLR), которая управляет выполнением кода, и oбширную библиотеку базовых классов (Base Class Library, BCL) для создания приложений.

Платформа версии .NET Framework 4.5.2 и более поздних версий — официальный
компонент операционной системы Windows. 

Все приложения на компьютере, разработанные для .NET Framework, используют одну и ту же версию CLR и библиотек, хранящихся в глобальном кэше сборок
(Global Assembly Cache, GAC), что может привести к неполадкам, если некоторым
из них потребуется определенная версия для совместимости.

В сущности, платформа .NET Framework работает только в среде Windows
и считается устаревшей. Не рекомендуется использовать данную платформу для создания новых приложений.

#### Проекты **Mono** и **Xamarin**

Сторонние разработчики создали .NET Framework под названием [Mono](http://www.monoproject.com). Хоть он и был кросс-платформенным, но значительно отставал от официальной реализации .NET Framework.

Проект Mono занял нишу в качестве основы мобильной платформы Xamarin, а также кросс-платформенных платформ для разработки игр, таких как [**Unity**](https://docs.unity3d.com/Manual/index.html).

В 2016 году корпорация Microsoft приобрела компанию Xamarin и теперь бесплатно предоставляет пользователям дорогостоящее решение Xamarin в качестве
расширения для среды разработки Visual Studio 2019.

### Обзор **.NET Core**

.NET Core основан на реорганизованом ядре .NET Framework, что было сделано в стремлении отделить .NET от Windows и обеспечить истинную кросс-платформенность.

.NET Core, включает кросс-платформенную реализацию рабочей общеязыковой исполняющей среды под названием CoreCLR и набор библиотек классов CoreFX.

Обновления, которые Microsoft может внести в .NET Core, нельзя добавить в .NET Framework.

[Больше информации о позиционировании Microsoft .NET Core и .NET Framework.](https://devblogs.microsoft.com/dotnet/update-on-net-core3-0-and-net-framework-4-8/)

### Обзор **.NET 5** и последующих версий **.NET**

.NET 5 была выпущена 10 ноября 2020 года и объединила различные платформы
.NET, кроме мобильных. Единая платформа .NET начнет поддерживать мобильные
устройства только в .NET 6 в ноябре 2021 года.

.NET Core будет переименована в .NET, а в номере основной версии
будет пропущен номер четыре, чтобы избежать путаницы с NET Framework 4.x. 
Корпорация Microsoft планирует выпускать ежегодные основные версии каждый ноябрь.

В данной книге, и соответственно, конспекте, речь идёт о версии .NET 5, хотя на сегодняшний день уже доступна версия .NET 7. 

### Поддержка **.NET Core**

Версии .NET сопровождаются либо долгосрочной поддержкой (long term support,
LTS), либо текущей (current), как описано ниже.
* Релизы LTS стабильны и требуют меньше обновлений в течение срока их службы. Это хороший выбор для приложений, не требующих частых обновлений.
Релизы LTS будут поддерживаться в течение трех лет после их выпуска.
* Текущие релизы включают функции, которые могут меняться в зависимости от
обратной связи. Это хороший выбор для активно разрабатываемых приложений, поскольку предоставляют доступ к последним обновлениям. После трех
месяцев обслуживания предыдущая вспомогательная версия больше не будет
поддерживаться.

В целях обеспечения безопасности и надежности критические обновления безопасности и надежности поставляются для релизов независимо от режима поддержки. 
Для получения поддержки вы всегда должны быть в курсе последних обновлений. 

Например, если вы создаете проект с использованием .NET 5.0 и Microsoft выпускает .NET 5.1 в феврале 2021 года, вам к концу мая 2021 года необходимо будет обновить свой проект до версии .NET 5.1.

>Cрок службы .NET 6.0 истекает в ноябре 2024 года (при условии, что выйдет
в ноябре 2021 года).

### Версии **.NET Runtime** и **.NET SDK**

Управление версиями .NET Runtime следует за семантическим управлением версиями, то есть большое приращение указывает на критические изменения, незначительное приращение указывает на новые функции, а приращение исправлений
указывает на исправления ошибок.

Управление версиями .NET SDK не следует за семантическим управлением версиями. Старший и дополнительный номера версий привязаны к версии среды
выполнения, с которой они совпадают. Номер патча соответствует соглашению, указывающему основную и вспомогательную версии SDK.

### Удаление старых версий **.NET**

Обновления среды выполнения .NET совместимы с основной версией, такой как
5.x, и обновленные выпуски .NET SDK поддерживают возможность создания
приложений, ориентированных на предыдущие версии среды выполнения, что
позволяет безопасно удалять старые версии.

Используя следующие команды, вы можете увидеть, какие SDK и среды выполнения в настоящее время установлены:

* `dotnet --list-sdks;`
* `dotnet --list-runtimes`

Для удаления пакетов SDK для .NET в Windows используйте раздел App & features
(Приложение и функции).
* удалить все версии SDK кроме последней: `dotnet-core-uninstall --all-previews-but-latest --sdk`

### В чем особенность **.NET Core**

Современная версия .NET менее объемна, чем текущая версия .NET Framework,
из-за того, что устаревшие технологии были удалены.

Одна из новых функций .NET 5 — поддержка запуска старых приложений Windows
Forms и WPF с помощью пакета Windows Desktop Pack, входящего в состав версии .NET 5 для операционной системы Windows

Компоненты ASP.NET Web Forms и Windows Communication Foundation (WCF) представляют собой устаревшие технологии для создания веб-приложений и сервисов,
используемые сегодня лишь некоторыми разработчиками, ввиду чего эти компоненты также были удалены из .NET 5. Вместо этого разработчики предпочитают
задействовать компоненты ASP.NET MVC и ASP.NET Web-API. Обе технологии были реорганизованы и объединены в новый продукт, ASP.NET Core (главы 15, 16 и 18.)

Помимо удаления значительных частей из .NET Framework для создания .NET
Core, Microsoft разделила .NET Core на пакеты NuGet, представляющие собой небольшие функциональные части, которые можно развернуть независимо.

### Обзор **.NET Standard**

В 2019 году с платформой .NET сложилась следующая ситуация: существует три
ветви платформы .NET, все из которых разрабатываются корпорацией Microsoft:
* .NET Core — для кросс-платформенных и новых приложений;
* .NET Framework — для устаревших приложений;
* Xamarin — для мобильных приложений.

В рамках .NET Standard 2.0 и более поздних версий корпорация Microsoft привела
все три платформы в соответствие с современным минимальным стандартом, что
значительно упростило разработчикам совместное использование кода с любой
разновидностью .NET.

После выпуска .NET 6 в ноябре 2021 года потребность в .NET Standard значительно уменьшится, поскольку для всех платформ, включая мобильные, будет единая
среда разработки .NET.

## Знакомство с промежуточным языком

Компилятор C# (под названием Roslyn), используемый инструментом командной
строки dotnet, конвертирует ваш исходный код на языке C# в код на промежуточном языке (intermediate language, IL) и сохраняет его в сборке (DLL- или EXEфайле). Операторы кода на промежуточном языке (IL) похожи на код ассемблера,
только выполняются с помощью виртуальной машины CoreCLR в .NET.

В процессе работы код IL загружается CoreCLR из сборки, динамически (just-intime, JIT) компилируется в инструкции CPU, а затем исполняется с помощью CPU на вашем компьютере. Преимущество такого трехэтапного процесса компиляции заключается в том, что Microsoft может создавать CLR не только для Windows, но и для Linux и macOS. Один и тот же код IL запускается в любой среде благодаря второму процессу компиляции, который генерирует код для конкретной операционной системы и набора команд CPU.

Независимо от того, на каком языке написан исходный код, например C#, Visual Basic или F#, все приложения .NET используют код IL для своих инструкций, хранящихся в сборке. Корпорация Microsoft и другие предоставляют инструменты  дизассемблера, которые могут открывать сборку и раскрывать данный код IL, например расширение декомпилятора ILSpy .NET.

## Сравнение технологий .NET

* **.NET 5**: Современный набор функций, полная поддержка C# 9, портирование уществующих и создание новых приложений для Windows и веб-приложений/сервисов;
* **.NET Framework**: Устаревший набор функций, ограниченная поддержка C# 8.0, отсутствие поддержки C# 9, поддержка существующих приложений. Существует  и работает только в Windows;
* **Xamarin**: Только для мобильных и настольных приложений.

## Разработка консольных приложений с использованием Visual Studio Code

### Написание кода с помощью Visual Studio Code

1. Запустите среду разработки Visual Studio Code.
2. Выберите `File` > `Open Folder` (Файл > Открыть папку) или нажмите сочетание клавиш Ctrl + K Ctrl + O. Вы можете нажать кнопку Open Folder (Открыть папку) на панели EXPLORER (Проводник) или щелкнуть кнопкой мыши на ссылке Open Folder (Открыть папку) на странице приветствия.
3. В открывшемся диалоговом окне перейдите к папке Documents в операционной
системе Windows или к любому каталогу или диску, на котором хотите сохранить свои проекты.
4. Нажмите кнопку New Folder (Новая папка) и назовите папку Code.
5. В папке Code создайте подпапку Chapter01.
6. В папке Chapter01 создайте подпапку HelloCS.
7. Выберите папку HelloCS и нажмите кнопку Select Folder (Выбрать папку).
8. Выберите `View` > `Terminal` (Вид > Терминал) или нажмите Ctrl + ' одинарная кавычка). В операционной системе Windows вводит в заблуждение комбинация клавиш Ctrl+` (обратный апостроф), которая разделяет текущее окно!
9. На панели TERMINAL (Терминал) введите следующую команду:
`dotnet new console`
10. Вы увидите, что инструмент командной строки **dotnet** создает в текущей папке
проект Console Application, а на панели EXPLORER (Проводник) отображаются
два созданных файла, HelloCS.proj и Program.cs (рис. 1.5).
11. На панели EXPLORER (Проводник) выберите файл Program.cs, чтобы открыть его
в окне редактора. При первом выполнении Visual Studio Code, возможно, придется загружать и устанавливать зависимые объекты C#, такие как OmniSharp,
Razor Language Server и отладчик .NET Core, если это не было сделано при установке расширения C#.
12. Если вы видите предупреждение о том, что необходимые ресурсы отсутствуют, то нажмите кнопку Yes (Да).
13. Через несколько секунд на панели EXPLORER (Проводник) появится папка .vscode. Более подробную информацию вы получите в главе 4.
14. В файле Program.cs измените строку 9 так, чтобы текст, который выводится
в консоль, сообщал: Hello, C#!.
15. Выберите команду меню `File` > `Auto Save` (Файл > Автосохранение). Она избавит вас от необходимости каждый раз вспоминать о сохранении перед повторным обновлением приложения.

### Компиляция и запуск кода с использованием инструмента командной строки **dotnet**

1. Выберите `View` > `Terminal` (Вид > Терминал) и введите следующую команду: `dotnet run`
2. На панели TERMINAL (Терминал) отобразится результат запуска вашего приложения

### Написание программ верхнего уровня

традиционное минимальное консольное приложение:  
`using System;`  
`class Program`  
`{`  
>`   static void Main(string[] args)`  

>`   {`  

>>`       Console.WriteLine("Hello World!");` 

>`   }`  

`}`  

новое консольное приложение верхнего уровня (.NET 5):  
`using System;`  
`Console.WriteLine("Hello World!");`

в .NET 7 мне оказалось достаточно следующего:  
`Console.WriteLine("Hello World!");`

Однако автор книги предпочитает использовать традиционный шаблон, особенно для обучения, поэтому будем и мы.  

## Скачивание кода решения из репозитория GitHub

[Ответы ко всем упражнениям, приведённым в книге](https://github.com/markjprice/cs9dotnet5)

### Клонирование репозитория с примерами из книги

1. Создайте папку Repos в пользовательской папке, или папке Documents, или там, где вы хотите хранить свои репозитории Git.
2. В программе Visual Studio Code откройте папку Repos.
3. Выберите `View` > `Terminal` (Вид > Терминал) и введите cледующую команду: `git clone https://github.com/markjprice/cs9dotnet5.git`
4. Клонирование всех решений для всех глав займет примерно минуту.

## Поиск справочной информации

### Знакомство с **Microsoft Docs**

Главным ресурсом, позволяющим получить справочные сведения об инструментах и платформах Microsoft, ранее был Microsoft Developer Network (MSDN). Теперь это Microsoft Docs, и вы можете найти его по адресу docs.microsoft.com.

Похоже что в 2023 это [Microsoft Learn](https://learn.microsoft.com/uk-ua/).

### Получение справки для инструмента dotnet

В командной строке вы можете запросить справочную информацию об инструменте dotnet.

1. Чтобы открыть в окне браузера официальную документацию для команды dotnet new, введите в командной строке или на панели TERMINAL (Терминал) программы Visual Studio Code следующую команду: `dotnet help new`
2. Чтобы вывести справочную информацию в командной строке, используйте ключ `-h` или `--help`:  
`dotnet new console -h`

### Получение определений типов и их элементов

Одна из наиболее полезных клавиш в Visual Studio Code — F12 для перехода к определению. С помощью данной клавиши вы увидите, как выглядит общедоступное определение типа или элемента, полученное чтением метаданных в скомпилированной сборке. Некоторые инструменты, такие как ILSpy .NET Decompiler, могут даже выполнить реверс-инжиниринг метаданных и кода IL в C#.

Пример использования функции Go To Definition

1. В программе Visual Studio Code откройте папку HelloCS.
2. В файле Program.cs в методе Main введите следующий код, чтобы объявить целочисленную переменную z:
`int z;`
3. Щелкните на слове int, а затем нажмите клавишу F12 или щелкните правой кнопкой мыши и выберите пункт Go To Definition (Перейти к определению) в контекстном меню. В появившемся окне вы можете увидеть определение типа данных int.  
Вы можете видеть, что int:
    * определяется с помощью ключевого слова `struct`;
    * находится в сборке System.Runtime;
    * находится в пространстве имен System;
    * называется Int32;
    * является, таким образом, псевдонимом для типа System.Int32;
    * реализует интерфейсы, такие как IComparable;
    * имеет постоянные значения для своих максимальных иминимальных значений;
    * имеет такие методы, как Parse

4. Прокрутите окно редактора кода вниз, чтобы найти метод Parse с параметром string, начинающимся со строки ~~87~~ 405 (C# 11). В комментарии вы увидите, что Microsoft задокументировала возникшие при вызове этого метода исключения, включая ArgumentNullException, FormatException и OverflowException. Теперь мы знаем, что нам необходимо обернуть вызов данного метода в оператор try и какие исключения необходимо перехватить.

>При попытке использовать команду `Go To Definition` (Перейти к определению) иногда появляется сообщение об ошибке `No definition found` (Определение не найдено). Это связано с тем, что расширение C# «не знает» о текущем проекте. Выберите `View` > `Command Palette` (Вид > Палитра команд), найдите пункт `OmniSharp:Select Project` и выберите его, а затем и правильный проект, с которым вы хотите работать.

### Ищем ответы на Stack Overflow

StackOverflow — самый популярный сторонний сайт, на котором можно найти ответы на сложные вопросы по программированию.

1. Откройте браузер.
2. Перейдите на любой поисковик и введите запрос.
3. Уточнение поиска для Google:  
`garbage collection site:stackoverflow.com +C# -Java`  
Таким образом мы ищем "garbage collection" на `stackoverflow.com` с тегом `C#` и исключая тег `Java`.

### Подписка на официальный блог .NET

https://devblogs.microsoft.com/dotnet/

### Видео от Скотта Хансельмана

http://computerstufftheydidnteachyou.com/

### Online редактор кода и компилятор 

https://dotnetfiddle.net



## Практические задания

### Упражнение 1.1. Проверочные вопросы

1. Почему на платформе .NET Core для разработки приложений программисты
могут использовать разные языки, например C# и F#?  
    * Потому что на платформе .NET Core код сначала преобразуется в промежуточный язык (intermediate language, IL) 

2. Какие команды нужно ввести для создания консольного приложения?
    * находяcь в терминале, в папке с будущим проектом `dotnet new console`
3. Какие команды нужно ввести в окне консоли для сборки и запуска исходного кода на языке C#?
    * `dotnet run`
4. Какое сочетание клавиш используется для открытия в программе Visual Studio Code панели TERMINAL (Терминал)?
    * ctrl + `
5. Среда разработки Visual Studio 2019 круче, чем Visual Studio Code?
    * Функция "круче" не определена. VS Code пользуется большей популярностью. 
6. Платформа .NET Core лучше .NET Framework?
    * .NET Framework существует только для Windows, .NET Core является кросплатформенной. В то же время далеко не все возможности .NET Framework представленны в .NET Core.
7. Что такое .NET Standard и почему он так важен?
    * .NET Standard это спецификация для набора API (прикладных интерфейсов), которая может быть реализована на всех платформах .NET (.NET Core, .NET Framework и Xamarin). Грубо говоря, это унификация интерфейсов для облегчения работы и обучения.  
    Необходимость в .NET Standard вероятно отпадёт или уже отпала с выходом новых версий .NET.

8. Как называется метод точки входа консольного приложения .NET и как его объявить?
    * https://learn.microsoft.com/ru-ru/dotnet/csharp/fundamentals/program-structure/main-command-line
    Метод Main — это точка входа приложения C#  
    Пример объявления:  
    >`class TestClass`  
    
    >`{`  
    
    >>`static void Main(string[] args)`  
    
    >>`{`  
    
    >>>`// Display the number of command line arguments.`   
    
    >>>`Console.WriteLine(args.Length);`  
    
    >>`}`  
    
    >`}` 

        * Начиная с версии C# 9, можно не указывать метод Main и писать инструкции C# как включенные в метод Main


9. Как найти справочную информацию по ключевому слову в C#?
    *   F12, ctrl + LMB позволяет перейти к определению ключевого слова. 
    *   Нагуглить документацию
    *   Нагуглить конкретный вопрос

10. Как найти решения общих проблем программирования?
    *   Если речь о локальных проблемах - повысить уровень квалификации в общем случае или нагуглить конкретное решение конкретной проблемы в частном.
    *   Если речь о глобальных общих проблемах програмирования, то я отвечу немного позже.


### Упражнение 1.2. Практическое задание

Вам не нужно устанавливать среду разработки **Visual Studio Code**, **Visual Studio 2019**, чтобы практиковаться в программировании на языке C#. Посетите сайт **.NET Fiddle** — https://dotnetfiddle.net — и начните кодирование в онлайн-режиме.

### Упражнение 1.3. Дополнительные ресурсы

Посетите следующие сайты, чтобы получить дополнительную информацию по темам, приведенным в этой главе:
* документация по Visual Studio Code: https://code.visualstudio.com/docs;
* .NET: https://dotnet.microsoft.com;
* инструменты интерфейса командной строки (CLI) .NET Core: https://aka.ms/dotnet-cli-docs;
* CoreCLR, общеязыковая исполняющая среда .NET Core: https://github.com/dotnet/runtime;
* путеводитель по .NET Core: https://github.com/dotnet/core/blob/master/roadmap.md;
* часто задаваемые вопросы о .NET Standard: https://github.com/dotnet/standard/blob/master/docs/faq.md;
* Stack Overflow: https://stackoverflow.com;
* расширенный поиск Google: https://www.google.com/advanced_search;
* виртуальная академия Microsoft: https://docs.microsoft.com/ru-ru/learn/;
* Microsoft Channel 9: видеоуроки для разработчиков: https://channel9.msdn.com/Search?term=.net&lang-en=true.